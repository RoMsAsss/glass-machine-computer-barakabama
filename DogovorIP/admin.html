<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    .bg-purple {
      background-color: #6f42c1;
    }
    .btn-purple {
      background-color: #6f42c1;
      color: white;
    }
    .history-item {
      border-left: 3px solid #0d6efd;
      padding-left: 10px;
      margin-bottom: 10px;
    }
    .empty-placeholder {
      color: #6c757d;
      font-style: italic;
    }
    .wheel-section-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    .wheel-color-picker {
      width: 40px;
      height: 40px;
      padding: 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <span class="navbar-brand">
        üëë –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü—Ä–∏–≤–µ—Ç, <span id="adminNameDisplay"></span>!
      </span>
      <button id="logoutBtn" class="btn btn-outline-light">–í—ã–π—Ç–∏</button>
    </div>
  </nav>

  <div class="container py-5">
    <div class="row">
      <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
      <div class="col-md-12 mb-4">
        <div class="card shadow">
          <div class="card-header bg-info text-white">
            <h5>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ü–æ–¥–ø–∏—Å–∫–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                  </tr>
                </thead>
                <tbody id="usersTable">
                  <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </tbody>
              </table>
            </div>

            <!-- –§–æ—Ä–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ -->
            <div class="mt-4">
              <h5>–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</h5>
              <form id="updateSubscriptionForm">
                <input type="hidden" id="editUserId">
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <select class="form-control" id="subscriptionType" required>
                      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</option>
                      <option value="basic">–ë–∞–∑–æ–≤—ã–π</option>
                      <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                      <option value="premium">–ü—Ä–µ–º–∏—É–º</option>
                      <option value="none">–ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏</option>
                    </select>
                  </div>
                  <div class="col-md-4 mb-3">
                    <input type="date" class="form-control" id="subscriptionExpiry">
                  </div>
                  <div class="col-md-4 mb-3">
                    <button type="submit" class="btn btn-primary w-100">–û–±–Ω–æ–≤–∏—Ç—å</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>


      <!-- –í —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ admin.html –¥–æ–±–∞–≤–∏–º: -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-info text-white">
            <h5>üìÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏</h5>
          </div>
          <div class="card-body">
            <ul class="nav nav-tabs mb-3" id="templatesTabs">
              <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#freeTemplates">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#premiumTemplates">–ü—Ä–µ–º–∏—É–º</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#uploadTemplate">–ó–∞–≥—Ä—É–∑–∏—Ç—å</a>
              </li>
            </ul>

            <div class="tab-content">
              <!-- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã -->
              <div class="tab-pane fade show active" id="freeTemplates">
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                      </tr>
                    </thead>
                    <tbody id="freeTemplatesList">
                      <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- –ü—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω—ã -->
              <div class="tab-pane fade" id="premiumTemplates">
                <div class="table-responsive">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                      </tr>
                    </thead>
                    <tbody id="premiumTemplatesList">
                      <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
              <div class="tab-pane fade" id="uploadTemplate">
                <form id="uploadTemplateForm">
                  <div class="mb-3">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                    <input type="text" class="form-control" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-control" rows="3"></textarea>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-control" id="templateCategory">
                      <option value="free">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</option>
                      <option value="contracts">–î–æ–≥–æ–≤–æ—Ä—ã</option>
                      <option value="policies">–ü–æ–ª–∏—Ç–∏–∫–∏</option>
                      <option value="offers">–û—Ñ–µ—Ä—Ç—ã</option>
                      <option value="nda">NDA</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">–§–∞–π–ª —à–∞–±–ª–æ–Ω–∞ (DOCX/PDF)</label>
                    <input type="file" class="form-control" id="templateFile" accept=".docx,.pdf" required>
                  </div>
                  <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="addWatermark" checked>
                    <label class="form-check-label" for="addWatermark">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</label>
                  </div>
                  <button type="submit" class="btn btn-primary w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-secondary text-white">
            <h5>üïí –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h5>
          </div>
          <div class="card-body" id="historyContainer">
            <div class="empty-placeholder">–ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-success text-white">
            <h5>‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h5>
          </div>
          <div class="card-body">
            <form id="addBlogPostForm">
              <div class="mb-3">
                <input type="text" class="form-control" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
              </div>
              <div class="mb-3">
                <textarea class="form-control" placeholder="–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏" rows="3" required></textarea>
              </div>
              <div class="mb-3">
                <input type="file" class="form-control" id="blogImage" accept="image/*">
              </div>
              <div class="mb-3">
                <label>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                <input type="datetime-local" class="form-control" id="publishDate">
              </div>
              <button type="submit" class="btn btn-success w-100">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </form>
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞–º–∏ -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <h5>üåü –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏</h5>
          </div>
          <div class="card-body">
            <form id="addReviewForm">
              <div class="mb-3">
                <input type="text" class="form-control" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞" required>
              </div>
              <div class="mb-3">
                <select class="form-control" required>
                  <option value="" disabled selected>–û—Ü–µ–Ω–∫–∞</option>
                  <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
                  <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</option>
                  <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</option>
                  <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</option>
                  <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ</option>
                </select>
              </div>
              <div class="mb-3">
                <textarea class="form-control" placeholder="–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞" rows="3" required></textarea>
              </div>
              <button type="submit" class="btn btn-primary w-100">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
            </form>
          </div>
        </div>
      </div>

      <!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-warning">
            <h5>‚è≥ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤</h5>
          </div>
          <div class="card-body" id="moderationContainer">
            <div class="empty-placeholder">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤-–æ—Ç–≤–µ—Ç–æ–≤ -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-warning">
            <h5>‚ùì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏-–æ—Ç–≤–µ—Ç–∞–º–∏</h5>
          </div>
          <div class="card-body">
            <form id="addFaqForm">
              <div class="mb-3">
                <input type="text" class="form-control" placeholder="–í–æ–ø—Ä–æ—Å" required>
              </div>
              <div class="mb-3">
                <textarea class="form-control" placeholder="–û—Ç–≤–µ—Ç" rows="3" required></textarea>
              </div>
              <button type="submit" class="btn btn-warning w-100">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            </form>
          </div>
        </div>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º —Ñ–æ—Ä—Ç—É–Ω—ã -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-purple text-white">
            <h5>üé° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º —Ñ–æ—Ä—Ç—É–Ω—ã</h5>
          </div>
          <div class="card-body">
            <div id="wheelSectionsContainer">
              <!-- –°–µ–∫—Ü–∏–∏ –∫–æ–ª–µ—Å–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            <button class="btn btn-sm btn-primary mt-3" id="addWheelSection">+ –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é</button>
            <div class="mt-3">
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—Ü–∏–π:</label>
              <input type="number" id="wheelSectionsCount" class="form-control" min="2" max="12" value="6">
            </div>
            <button class="btn btn-purple w-100 mt-3" id="saveWheelSettings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          </div>
        </div>
      </div>

      <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ -->
      <div class="col-md-6 mb-4">
        <div class="card shadow">
          <div class="card-header bg-danger text-white">
            <h5>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏</h5>
          </div>
          <div class="card-body">
            <form id="addAdminForm">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <input type="text" class="form-control" placeholder="–ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" required>
                </div>
                <div class="col-md-6 mb-3">
                  <input type="password" class="form-control" placeholder="–ü–∞—Ä–æ–ª—å" required>
                </div>
              </div>
              <button type="submit" class="btn btn-danger w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if (!localStorage.getItem('adminAuth') || localStorage.getItem('adminAuth') !== 'admin@dogovorip.ru') {
      window.location.href = 'login.html';
    } else {
      document.getElementById('adminNameDisplay').textContent = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.removeItem('adminAuth');
      window.location.href = 'index.html';
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats() {
      const today = new Date().toLocaleDateString();
      let stats = JSON.parse(localStorage.getItem('siteStats')) || {
        visits: {},
        totalUsers: 0,
        history: []
      };

      stats.visits[today] = (stats.visits[today] || 0) + 1;
      localStorage.setItem('siteStats', JSON.stringify(stats));

      document.getElementById('visitsToday').textContent = stats.visits[today];
      document.getElementById('totalUsers').textContent = stats.totalUsers + Math.floor(Math.random() * 10);

      // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
      const historyContainer = document.getElementById('historyContainer');
      if (stats.history.length > 0) {
        historyContainer.innerHTML = '';
        stats.history.forEach(item => {
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          historyItem.innerHTML = `
            <strong>${item.action}</strong>
            <div class="text-muted small">${new Date(item.date).toLocaleString()}</div>
            <div>${item.details || ''}</div>
          `;
          historyContainer.appendChild(historyItem);
        });
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
    function addHistory(action, details = '') {
      let stats = JSON.parse(localStorage.getItem('siteStats')) || {
        visits: {},
        totalUsers: 0,
        history: []
      };

      stats.history.unshift({
        action,
        details,
        date: new Date().toISOString()
      });

      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏
      stats.history = stats.history.slice(0, 50);
      localStorage.setItem('siteStats', JSON.stringify(stats));
      updateStats();
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ –±–ª–æ–≥
    document.getElementById('addBlogPostForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = this.querySelector('input').value;
      const content = this.querySelector('textarea').value;
      const publishDate = document.getElementById('publishDate').value;
      const imageFile = document.getElementById('blogImage').files[0];

      let blogPosts = JSON.parse(localStorage.getItem('blogPosts')) || [];
      const newPost = {
        id: Date.now(),
        title,
        content,
        date: new Date().toISOString(),
        publishDate: publishDate || new Date().toISOString()
      };

      if (imageFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          newPost.image = e.target.result;
          blogPosts.push(newPost);
          localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
          addHistory('–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å –≤ –±–ª–æ–≥', title);
          alert('–ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
          e.target.form.reset();
        };
        reader.readAsDataURL(imageFile);
      } else {
        blogPosts.push(newPost);
        localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
        addHistory('–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å –≤ –±–ª–æ–≥', title);
        alert('–ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        this.reset();
      }
    });

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
    document.getElementById('addReviewForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const author = this.querySelector('input').value;
      const rating = this.querySelector('select').value;
      const text = this.querySelector('textarea').value;

      let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
      reviews.push({ author, rating: parseInt(rating), text, date: new Date().toISOString() });
      localStorage.setItem('reviews', JSON.stringify(reviews));

      addHistory('–î–æ–±–∞–≤–ª–µ–Ω –æ—Ç–∑—ã–≤', `–û—Ç ${author}, –æ—Ü–µ–Ω–∫–∞: ${rating}`);
      alert('–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω!');
      this.reset();
    });

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞-–æ—Ç–≤–µ—Ç–∞
    document.getElementById('addFaqForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const question = this.querySelector('input').value;
      const answer = this.querySelector('textarea').value;

      let faqItems = JSON.parse(localStorage.getItem('faq')) || [];
      faqItems.push({ question, answer });
      localStorage.setItem('faq', JSON.stringify(faqItems));

      addHistory('–î–æ–±–∞–≤–ª–µ–Ω –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç', question);
      alert('–í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω!');
      this.reset();
    });

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    document.getElementById('addAdminForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = this.querySelectorAll('input')[0].value;
      const password = this.querySelectorAll('input')[1].value;

      let admins = JSON.parse(localStorage.getItem('admins')) || {};
      admins[name] = password;
      localStorage.setItem('admins', JSON.stringify(admins));

      addHistory('–î–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', name);
      alert('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
      this.reset();
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º —Ñ–æ—Ä—Ç—É–Ω—ã
    function loadWheelSettings() {
      const settings = JSON.parse(localStorage.getItem('wheelSettings')) || {
        sections: [
          { text: "10% —Å–∫–∏–¥–∫–∞", color: "#FF6384", chance: 20, promo: "WHEEL10" },
          { text: "15% —Å–∫–∏–¥–∫–∞", color: "#36A2EB", chance: 15, promo: "WHEEL15" },
          { text: "20% —Å–∫–∏–¥–∫–∞", color: "#FFCE56", chance: 10, promo: "WHEEL20" },
          { text: "3 –¥–Ω—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ", color: "#4BC0C0", chance: 5, promo: "FREE3DAYS" },
          { text: "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω", color: "#9966FF", chance: 10, promo: "FREEDOC" },
          { text: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ", color: "#FF9F40", chance: 40, promo: "TRYAGAIN" }
        ]
      };

      renderWheelSections(settings.sections);
      document.getElementById('wheelSectionsCount').value = settings.sections.length;
    }

    function renderWheelSections(sections) {
      const container = document.getElementById('wheelSectionsContainer');
      container.innerHTML = '';

      sections.forEach((section, index) => {
        const sectionElement = document.createElement('div');
        sectionElement.className = 'wheel-section-item';
        sectionElement.innerHTML = `
          <input type="color" class="wheel-color-picker" value="${section.color}" data-index="${index}">
          <input type="text" class="form-control me-2" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–∞" value="${section.text}" data-index="${index}">
          <input type="number" class="form-control me-2" placeholder="–®–∞–Ω—Å (%)" min="1" max="100" value="${section.chance}" data-index="${index}">
          <input type="text" class="form-control" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" value="${section.promo}" data-index="${index}">
        `;
        container.appendChild(sectionElement);
      });
    }

    function saveWheelSettings() {
      const sectionsCount = parseInt(document.getElementById('wheelSectionsCount').value);
      const inputs = document.querySelectorAll('#wheelSectionsContainer input');
      const sections = [];

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
      const sectionsData = {};
      inputs.forEach(input => {
        const index = input.dataset.index;
        if (!sectionsData[index]) sectionsData[index] = {};

        if (input.type === 'color') {
          sectionsData[index].color = input.value;
        } else if (input.placeholder === '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–∞') {
          sectionsData[index].text = input.value;
        } else if (input.placeholder === '–®–∞–Ω—Å (%)') {
          sectionsData[index].chance = parseInt(input.value) || 10;
        } else if (input.placeholder === '–ü—Ä–æ–º–æ–∫–æ–¥') {
          sectionsData[index].promo = input.value;
        }
      });

      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º —à–∞–Ω—Å—ã
      let totalChance = 0;
      for (let i = 0; i < sectionsCount; i++) {
        if (sectionsData[i]) {
          sections.push(sectionsData[i]);
          totalChance += sectionsData[i].chance || 0;
        }
      }

      // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–Ω—Å–æ–≤
      sections.forEach(section => {
        section.chance = Math.round((section.chance / totalChance) * 100);
      });

      fetch('/api/wheel', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ sections })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Settings saved:', data);
        addHistory('–ò–∑–º–µ–Ω–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–µ—Å–∞ —Ñ–æ—Ä—Ç—É–Ω—ã');
      })
      .catch(error => {
        console.error('Error saving settings:', error);
      });
      addHistory('–ò–∑–º–µ–Ω–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–µ—Å–∞ —Ñ–æ—Ä—Ç—É–Ω—ã');
      alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    }

    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('addWheelSection').addEventListener('click', function() {
      const count = parseInt(document.getElementById('wheelSectionsCount').value);
      document.getElementById('wheelSectionsCount').value = count + 1;
    });

    document.getElementById('wheelSectionsCount').addEventListener('change', function() {
      const count = parseInt(this.value);
      const currentCount = document.querySelectorAll('.wheel-section-item').length;

      if (count < 2) this.value = 2;
      if (count > 12) this.value = 12;

      if (count > currentCount) {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
        const sections = JSON.parse(localStorage.getItem('wheelSettings'))?.sections || [];
        while (sections.length < count) {
          sections.push({
            text: `–ü—Ä–∏–∑ ${sections.length + 1}`,
            color: getRandomColor(),
            chance: Math.floor(100 / count),
            promo: `PRIZE${sections.length + 1}`
          });
        }
        renderWheelSections(sections);
      } else if (count < currentCount) {
        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Å–µ–∫—Ü–∏–∏
        const container = document.getElementById('wheelSectionsContainer');
        while (container.children.length > count) {
          container.removeChild(container.lastChild);
        }
      }
    });

    document.getElementById('saveWheelSettings').addEventListener('click', saveWheelSettings);

    // –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤
    function loadReviewsForModeration() {
      const pendingReviews = JSON.parse(localStorage.getItem('pendingReviews')) || [];
      const container = document.getElementById('moderationContainer');

      if (pendingReviews.length === 0) {
        container.innerHTML = '<div class="empty-placeholder">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>';
        return;
      }

      container.innerHTML = '';
      pendingReviews.forEach((review, index) => {
        const reviewElement = document.createElement('div');
        reviewElement.className = 'mb-3 p-3 border rounded';
        reviewElement.innerHTML = `
          <h6>${review.author}</h6>
          <div class="mb-2">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</div>
          <p>${review.text}</p>
          <small class="text-muted d-block mb-2">${new Date(review.date).toLocaleString()}</small>
          <div>
            <button class="btn btn-sm btn-success me-2 approve-review" data-index="${index}">–û–¥–æ–±—Ä–∏—Ç—å</button>
            <button class="btn btn-sm btn-danger reject-review" data-index="${index}">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
          </div>
        `;
        container.appendChild(reviewElement);
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
      document.querySelectorAll('.approve-review').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          const pendingReviews = JSON.parse(localStorage.getItem('pendingReviews')) || [];
          const approvedReviews = JSON.parse(localStorage.getItem('approvedReviews')) || [];

          approvedReviews.push(pendingReviews[index]);
          pendingReviews.splice(index, 1);

          localStorage.setItem('pendingReviews', JSON.stringify(pendingReviews));
          localStorage.setItem('approvedReviews', JSON.stringify(approvedReviews));

          addHistory('–û–¥–æ–±—Ä–µ–Ω –æ—Ç–∑—ã–≤', `–û—Ç ${approvedReviews[approvedReviews.length - 1].author}`);
          loadReviewsForModeration();
        });
      });

      document.querySelectorAll('.reject-review').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          const pendingReviews = JSON.parse(localStorage.getItem('pendingReviews')) || [];
          const rejectedReview = pendingReviews[index];

          pendingReviews.splice(index, 1);
          localStorage.setItem('pendingReviews', JSON.stringify(pendingReviews));

          addHistory('–û—Ç–∫–ª–æ–Ω–µ–Ω –æ—Ç–∑—ã–≤', `–û—Ç ${rejectedReview.author}`);
          loadReviewsForModeration();
        });
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateStats();
    addHistory('–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å');
    loadWheelSettings();
    loadReviewsForModeration();

    // –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if (!localStorage.getItem('admins')) {
      localStorage.setItem('admins', JSON.stringify({
        "admin": "123",
        "manager": "password"
      }));
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    function loadUsers() {
      fetch('/api/users')
        .then(response => response.json())
        .then(users => {
          const table = document.getElementById('usersTable');
          table.innerHTML = '';

          if (users.length === 0) {
            table.innerHTML = '<tr><td colspan="5" class="text-center">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
            return;
          }

          users.forEach(user => {
            const row = document.createElement('tr');

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
            let subscriptionStatus = '–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏';
            let subscriptionClass = 'text-danger';

            if (user.subscription_type) {
              const expiryDate = user.subscription_expiry ? new Date(user.subscription_expiry) : null;
              const today = new Date();

              if (expiryDate && expiryDate < today) {
                subscriptionStatus = `–ò—Å—Ç–µ–∫–ª–∞ (${user.subscription_type})`;
                subscriptionClass = 'text-warning';
              } else if (user.subscription_type === 'admin') {
                subscriptionStatus = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                subscriptionClass = 'text-success';
              } else {
                subscriptionStatus = `${user.subscription_type} –¥–æ ${expiryDate ? expiryDate.toLocaleDateString() : '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`;
                subscriptionClass = 'text-success';
              }
            }

            row.innerHTML = `
              <td>${user.id}</td>
              <td>${user.email}</td>
              <td>${user.verified ? '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' : '–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω'}</td>
              <td class="${subscriptionClass}">${subscriptionStatus}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary edit-user" data-id="${user.id}">–ò–∑–º–µ–Ω–∏—Ç—å</button>
              </td>
            `;
            table.appendChild(row);
          });

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
          document.querySelectorAll('.edit-user').forEach(btn => {
            btn.addEventListener('click', function() {
              const userId = this.dataset.id;
              const user = users.find(u => u.id == userId);

              document.getElementById('editUserId').value = user.id;
              document.getElementById('subscriptionType').value = user.subscription_type || '';
              document.getElementById('subscriptionExpiry').value = user.subscription_expiry || '';
            });
          });
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
    document.getElementById('updateSubscriptionForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const userId = document.getElementById('editUserId').value;
      const subscriptionType = document.getElementById('subscriptionType').value;
      const expiryDate = document.getElementById('subscriptionExpiry').value;

      fetch('/api/users/update-subscription', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId,
          subscriptionType: subscriptionType === 'none' ? null : subscriptionType,
          expiryDate
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('–ü–æ–¥–ø–∏—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
          loadUsers();
          this.reset();
        } else {
          alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: ' + (data.message || ''));
        }
      })
      .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏');
      });
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
    loadUsers();

          async function loadTemplates() {
        try {
          const [freeRes, premiumRes] = await Promise.all([
            fetch('/api/templates?isFree=true'),
            fetch('/api/templates?isFree=false')
          ]);

          const freeData = await freeRes.json();
          const premiumData = await premiumRes.json();

          renderTemplates(freeData.templates, 'freeTemplatesList');
          renderTemplates(premiumData.templates, 'premiumTemplatesList');
        } catch (error) {
          console.error('Error loading templates:', error);
          alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤');
        }
      }

      function renderTemplates(templates, containerId) {
        const container = document.getElementById(containerId);

        if (templates.length === 0) {
          container.innerHTML = '<tr><td colspan="3" class="text-center">–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤</td></tr>';
          return;
        }

        container.innerHTML = '';

        templates.forEach(template => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${template.name}</td>
            <td>${template.category}</td>
            <td>${new Date(template.createdAt).toLocaleDateString()}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary preview-template" data-id="${template.id}">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger delete-template" data-id="${template.id}">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          `;
          container.appendChild(row);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        document.querySelectorAll('.preview-template').forEach(btn => {
          btn.addEventListener('click', function() {
            const templateId = this.dataset.id;
            previewTemplate(templateId);
          });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
        document.querySelectorAll('.delete-template').forEach(btn => {
          btn.addEventListener('click', function() {
            const templateId = this.dataset.id;
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω?')) {
              deleteTemplate(templateId);
            }
          });
        });
      }

      async function previewTemplate(templateId) {
        try {
          const response = await fetch(`/api/templates/${templateId}`);
          const template = await response.json();

          window.open(`/templates/${template.filename}`, '_blank');
        } catch (error) {
          console.error('Error previewing template:', error);
          alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞');
        }
      }

      async function deleteTemplate(templateId) {
        try {
          const response = await fetch(`/api/templates/${templateId}`, { method: 'DELETE' });
          const result = await response.json();

          if (result.success) {
            alert('–®–∞–±–ª–æ–Ω —É–¥–∞–ª–µ–Ω');
            loadTemplates();
            addHistory('–£–¥–∞–ª–µ–Ω —à–∞–±–ª–æ–Ω', `ID: ${templateId}`);
          } else {
            alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞');
          }
        } catch (error) {
          console.error('Error deleting template:', error);
          alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞');
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∑–∫–∏
      document.getElementById('uploadTemplateForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append('name', this.querySelector('input[type="text"]').value);
        formData.append('description', this.querySelector('textarea').value);
        formData.append('category', document.getElementById('templateCategory').value);
        formData.append('addWatermark', document.getElementById('addWatermark').checked);
        formData.append('templateFile', document.getElementById('templateFile').files[0]);

        try {
          const response = await fetch('/api/templates/upload', {
            method: 'POST',
            body: formData
          });

          const result = await response.json();

          if (result.success) {
            alert('–®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω');
            this.reset();
            loadTemplates();
            addHistory('–ó–∞–≥—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω', result.template.name);
          } else {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞: ' + (result.error || ''));
          }
        } catch (error) {
          console.error('Error uploading template:', error);
          alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞');
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      loadTemplates();
    });
  </script>
</body>
</html>